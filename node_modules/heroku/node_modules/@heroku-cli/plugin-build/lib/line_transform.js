"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const stream = require("stream");
class LineTransform extends stream.Transform {
    constructor(options = {}) {
        super(Object.assign({}, options, { decodeStrings: false }));
    }
    _flush(done) {
        if (this._lastLineData)
            this.push(this._lastLineData);
        delete this._lastLineData;
        done();
    }
    _transform(chunk, _, next) {
        let data = chunk;
        if (this._lastLineData)
            data = this._lastLineData + data;
        let lines = data.split('\n');
        this._lastLineData = lines.splice(lines.length - 1, 1)[0];
        lines.forEach(this.push.bind(this));
        next();
    }
}
exports.default = LineTransform;
